<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.13.1 -->
<document source="/home/fbaumanis/openstack/soc8_test/openstack_repo/manila/doc/source/admin/shared-file-systems-crud-share.rst">
    <target refid="shared-file-systems-crud-share"></target>
    <section ids="share-basic-operations shared-file-systems-crud-share" names="share\ basic\ operations shared_file_systems_crud_share">
        <title>Share basic operations</title>
        <section ids="general-concepts" names="general\ concepts">
            <title>General concepts</title>
            <paragraph>To create a file share, and access it, the following general concepts
                are prerequisite knowledge:</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>To create a share, use <literal_strong classes="command">manila create</literal_strong> command and
                        specify the required arguments: the size of the share and the shared file
                        system protocol. <literal>NFS</literal>, <literal>CIFS</literal>, <literal>GlusterFS</literal>, <literal>HDFS</literal>, or
                        <literal>CephFS</literal> share file system protocols are supported.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>You can also optionally specify the share network and the share type.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>After the share becomes available, use the <literal_strong classes="command">manila show</literal_strong> command
                        to get the share export locations.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>After getting the share export locations, you can create an
                        <reference internal="True" refid="access-to-share"><inline classes="std std-ref">access rule</inline></reference> for the share, mount it and work with
                        files on the remote file system.</paragraph>
                </list_item>
            </enumerated_list>
            <paragraph>There are big number of the share drivers created by different vendors in the
                Shared File Systems service. As a Python class, each share driver can be set
                for the <reference internal="True" refuri="shared-file-systems-multi-backend#shared-file-systems-multi-backend"><inline classes="std std-ref">back end</inline></reference> and run in the back
                end to manage the share operations.</paragraph>
            <paragraph>Initially there are two driver modes for the back ends:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>no share servers mode</paragraph>
                </list_item>
                <list_item>
                    <paragraph>share servers mode</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>Each share driver supports one or two of possible back end modes that can be
                configured in the <literal>manila.conf</literal> file. The configuration option
                <literal>driver_handles_share_servers</literal> in the <literal>manila.conf</literal> file sets the share
                servers mode or no share servers mode, and defines the driver mode for share
                storage lifecycle management:</paragraph>
            <table>
                <tgroup cols="3">
                    <colspec colwidth="18"></colspec>
                    <colspec colwidth="37"></colspec>
                    <colspec colwidth="20"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Mode</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Config option</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>no share servers</paragraph>
                            </entry>
                            <entry>
                                <paragraph>driver_handles_share_servers = False</paragraph>
                            </entry>
                            <entry>
                                <paragraph>An administrator
                                    rather than a share
                                    driver manages the
                                    bare metal storage
                                    with some net
                                    interface instead
                                    of the presence of
                                    the share servers.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>share servers</paragraph>
                            </entry>
                            <entry>
                                <paragraph>driver_handles_share_servers = True</paragraph>
                            </entry>
                            <entry>
                                <paragraph>The share driver
                                    creates the share
                                    server and manages,
                                    or handles, the
                                    share server life
                                    cycle.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <paragraph>It is <reference internal="True" refuri="shared-file-systems-share-types#shared-file-systems-share-types"><inline classes="std std-ref">the share types</inline></reference> which have the
                extra specifications that help scheduler to filter back ends and choose the
                appropriate back end for the user that requested to create a share. The
                required extra boolean specification for each share type is
                <literal>driver_handles_share_servers</literal>. As an administrator, you can create the share
                types with the specifications you need. For details of managing the share types
                and configuration the back ends, see <reference internal="True" refuri="shared-file-systems-share-types#shared-file-systems-share-types"><inline classes="std std-ref">Share types</inline></reference> and
                <reference internal="True" refuri="shared-file-systems-multi-backend#shared-file-systems-multi-backend"><inline classes="std std-ref">Multi-storage configuration</inline></reference> documentation.</paragraph>
            <paragraph>You can create a share in two described above modes:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>in a no share servers mode without specifying the share network and
                        specifying the share type with <literal>driver_handles_share_servers = False</literal>
                        parameter. See subsection <reference internal="True" refid="create-share-in-no-share-server-mode"><inline classes="std std-ref">Create a share in no share servers mode</inline></reference>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>in a share servers mode with specifying the share network and the share
                        type with <literal>driver_handles_share_servers = True</literal> parameter. See subsection
                        <reference internal="True" refid="create-share-in-share-server-mode"><inline classes="std std-ref">Create a share in share servers mode</inline></reference>.</paragraph>
                </list_item>
            </bullet_list>
            <target refid="create-share-in-no-share-server-mode"></target>
        </section>
        <section ids="create-a-share-in-no-share-servers-mode create-share-in-no-share-server-mode" names="create\ a\ share\ in\ no\ share\ servers\ mode create_share_in_no_share_server_mode">
            <title>Create a share in no share servers mode</title>
            <paragraph>To create a file share in no share servers mode, you need to:</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>To create a share, use <literal_strong classes="command">manila create</literal_strong> command and
                        specify the required arguments: the size of the share and the shared file
                        system protocol. <literal>NFS</literal>, <literal>CIFS</literal>, <literal>GlusterFS</literal>, <literal>HDFS</literal>, or
                        <literal>CephFS</literal> share file system protocols are supported.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>You should specify the <reference internal="True" refuri="shared-file-systems-share-types#shared-file-systems-share-types"><inline classes="std std-ref">share type</inline></reference>
                        with <literal>driver_handles_share_servers = False</literal> extra specification.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>You must not specify the <literal>share network</literal> because no share servers are
                        created. In this mode the Shared File Systems service expects that
                        administrator has some bare metal storage with some net interface.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The <literal_strong classes="command">manila create</literal_strong> command creates a share. This command does the
                        following things:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>The <reference internal="True" refuri="shared-file-systems-scheduling#shared-file-systems-scheduling"><inline classes="std std-ref">manila-scheduler</inline></reference> service will
                                find the back end with <literal>driver_handles_share_servers = False</literal> mode due
                                to filtering the extra specifications of the share type.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>The share is created using the storage that is specified in the found
                                back end.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>After the share becomes available, use the <literal_strong classes="command">manila show</literal_strong> command
                        to get the share export locations.</paragraph>
                </list_item>
            </enumerated_list>
            <paragraph>In the example to create a share, the created already share type named
                <literal>my_type</literal> with <literal>driver_handles_share_servers = False</literal> extra specification
                is used.</paragraph>
            <paragraph>Check share types that exist, run:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila type-list
+------+---------+------------+------------+--------------------------------------+-------------------------+
| ID   | Name    | visibility | is_default | required_extra_specs                 | optional_extra_specs    |
+------+---------+------------+------------+--------------------------------------+-------------------------+
| %ID% | my_type | public     | -          | driver_handles_share_servers : False | snapshot_support : True |
+------+---------+------------+------------+--------------------------------------+-------------------------+</literal_block>
            <paragraph>Create a private share with <literal>my_type</literal> share type, NFS shared file system
                protocol, and size 1 GB:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila create nfs 1 --name Share1 --description "My share" --share-type my_type
+-----------------------------+--------------------------------------+
| Property                    | Value                                |
+-----------------------------+--------------------------------------+
| status                      | creating                             |
| share_type_name             | my_type                              |
| description                 | My share                             |
| availability_zone           | None                                 |
| share_network_id            | None                                 |
| share_server_id             | None                                 |
| host                        |                                      |
| access_rules_status         | active                               |
| snapshot_id                 | None                                 |
| is_public                   | False                                |
| task_state                  | None                                 |
| snapshot_support            | True                                 |
| id                          | 10f5a2a1-36f5-45aa-a8e6-00e94e592e88 |
| size                        | 1                                    |
| name                        | Share1                               |
| share_type                  | 14ee8575-aac2-44af-8392-d9c9d344f392 |
| has_replicas                | False                                |
| replication_type            | None                                 |
| created_at                  | 2016-03-25T12:02:46.000000           |
| share_proto                 | NFS                                  |
| consistency_group_id        | None                                 |
| source_cgsnapshot_member_id | None                                 |
| project_id                  | 907004508ef4447397ce6741a8f037c1     |
| metadata                    | {}                                   |
+-----------------------------+--------------------------------------+</literal_block>
            <paragraph>New share <literal>Share2</literal> should have a status <literal>available</literal>:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila show Share2
+-----------------------------+----------------------------------------------------------+
| Property                    | Value                                                    |
+-----------------------------+----------------------------------------------------------+
| status                      | available                                                |
| share_type_name             | my_type                                                  |
| description                 | My share                                                 |
| availability_zone           | nova                                                     |
| share_network_id            | None                                                     |
| export_locations            |                                                          |
|                             | path = 10.0.0.4:/shares/manila_share_a5fb1ab7_...        |
|                             | preferred = False                                        |
|                             | is_admin_only = False                                    |
|                             | id = 9e078eee-bcad-40b8-b4fe-1c916cf98ed1                |
|                             | share_instance_id = a5fb1ab7-0bbd-465b-ac14-05706294b6e9 |
|                             | path = 172.18.198.52:/shares/manila_share_a5fb1ab7_...   |
|                             | preferred = False                                        |
|                             | is_admin_only = True                                     |
|                             | id = 44933f59-e0e3-4483-bb88-72ba7c486f41                |
|                             | share_instance_id = a5fb1ab7-0bbd-465b-ac14-05706294b6e9 |
| share_server_id             | None                                                     |
| host                        | manila@paris#epsilon                                     |
| access_rules_status         | active                                                   |
| snapshot_id                 | None                                                     |
| is_public                   | False                                                    |
| task_state                  | None                                                     |
| snapshot_support            | True                                                     |
| id                          | 10f5a2a1-36f5-45aa-a8e6-00e94e592e88                     |
| size                        | 1                                                        |
| name                        | Share1                                                   |
| share_type                  | 14ee8575-aac2-44af-8392-d9c9d344f392                     |
| has_replicas                | False                                                    |
| replication_type            | None                                                     |
| created_at                  | 2016-03-25T12:02:46.000000                               |
| share_proto                 | NFS                                                      |
| consistency_group_id        | None                                                     |
| source_cgsnapshot_member_id | None                                                     |
| project_id                  | 907004508ef4447397ce6741a8f037c1                         |
| metadata                    | {}                                                       |
+-----------------------------+----------------------------------------------------------+</literal_block>
            <target refid="create-share-in-share-server-mode"></target>
        </section>
        <section ids="create-a-share-in-share-servers-mode create-share-in-share-server-mode" names="create\ a\ share\ in\ share\ servers\ mode create_share_in_share_server_mode">
            <title>Create a share in share servers mode</title>
            <paragraph>To create a file share in share servers mode, you need to:</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>To create a share, use <literal_strong classes="command">manila create</literal_strong> command and
                        specify the required arguments: the size of the share and the shared file
                        system protocol. <literal>NFS</literal>, <literal>CIFS</literal>, <literal>GlusterFS</literal>, <literal>HDFS</literal>, or
                        <literal>CephFS</literal> share file system protocols are supported.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>You should specify the <reference internal="True" refuri="shared-file-systems-share-types#shared-file-systems-share-types"><inline classes="std std-ref">share type</inline></reference>
                        with <literal>driver_handles_share_servers = True</literal> extra specification.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>You should specify the
                        <reference internal="True" refuri="shared-file-systems-share-networks#shared-file-systems-share-networks"><inline classes="std std-ref">share network</inline></reference>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The <literal_strong classes="command">manila create</literal_strong> command creates a share. This command does the
                        following things:</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph>The <reference internal="True" refuri="shared-file-systems-scheduling#shared-file-systems-scheduling"><inline classes="std std-ref">manila-scheduler</inline></reference> service will
                                find the back end with <literal>driver_handles_share_servers = True</literal> mode due to
                                filtering the extra specifications of the share type.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>The share driver will create a share server with the share network. For
                                details of creating the resources, see the <reference name="documentation" refuri="http://docs.openstack.org/developer/manila/devref/index.html#share-backends">documentation</reference><target ids="documentation" names="documentation" refuri="http://docs.openstack.org/developer/manila/devref/index.html#share-backends"></target> of the
                                specific share driver.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>After the share becomes available, use the <literal_strong classes="command">manila show</literal_strong> command
                        to get the share export location.</paragraph>
                </list_item>
            </enumerated_list>
            <paragraph>In the example to create a share, the default share type and the already
                existing share network are used.</paragraph>
            <note>
                <paragraph>There is no default share type just after you started manila as the
                    administrator. See <reference internal="True" refuri="shared-file-systems-share-types#shared-file-systems-share-types"><inline classes="std std-ref">Share types</inline></reference> to
                    create the default share type. To create a share network, use
                    <reference internal="True" refuri="shared-file-systems-share-networks#shared-file-systems-share-networks"><inline classes="std std-ref">Share networks</inline></reference>.</paragraph>
            </note>
            <paragraph>Check share types that exist, run:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila type-list
+------+---------+------------+------------+--------------------------------------+-------------------------+
| ID   | Name    | visibility | is_default | required_extra_specs                 | optional_extra_specs    |
+------+---------+------------+------------+--------------------------------------+-------------------------+
| %id% | default | public     | YES        | driver_handles_share_servers : True  | snapshot_support : True |
+------+---------+------------+------------+--------------------------------------+-------------------------+</literal_block>
            <paragraph>Check share networks that exist, run:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila share-network-list
+--------------------------------------+--------------+
| id                                   | name         |
+--------------------------------------+--------------+
| c895fe26-92be-4152-9e6c-f2ad230efb13 | my_share_net |
+--------------------------------------+--------------+</literal_block>
            <paragraph>Create a public share with <literal>my_share_net</literal> network, <literal>default</literal>
                share type, NFS shared file system protocol, and size 1 GB:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila create nfs 1 \
    --name "Share2" \
    --description "My second share" \
    --share-type default \
    --share-network my_share_net \
    --metadata aim=testing \
    --public
+-----------------------------+--------------------------------------+
| Property                    | Value                                |
+-----------------------------+--------------------------------------+
| status                      | creating                             |
| share_type_name             | default                              |
| description                 | My second share                      |
| availability_zone           | None                                 |
| share_network_id            | c895fe26-92be-4152-9e6c-f2ad230efb13 |
| share_server_id             | None                                 |
| host                        |                                      |
| access_rules_status         | active                               |
| snapshot_id                 | None                                 |
| is_public                   | True                                 |
| task_state                  | None                                 |
| snapshot_support            | True                                 |
| id                          | 195e3ba2-9342-446a-bc93-a584551de0ac |
| size                        | 1                                    |
| name                        | Share2                               |
| share_type                  | bf6ada49-990a-47c3-88bc-c0cb31d5c9bf |
| has_replicas                | False                                |
| replication_type            | None                                 |
| created_at                  | 2016-03-25T12:13:40.000000           |
| share_proto                 | NFS                                  |
| consistency_group_id        | None                                 |
| source_cgsnapshot_member_id | None                                 |
| project_id                  | 907004508ef4447397ce6741a8f037c1     |
| metadata                    | {u'aim': u'testing'}                 |
+-----------------------------+--------------------------------------+</literal_block>
            <paragraph>The share also can be created from a share snapshot. For details, see
                <reference internal="True" refuri="shared-file-systems-snapshots#shared-file-systems-snapshots"><inline classes="std std-ref">Share snapshots</inline></reference>.</paragraph>
            <paragraph>See the share in a share list:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila list
+--------------------------------------+---------+------+-------------+-----------+-----------+-----------------+----------------------+-------------------+
| ID                                   | Name    | Size | Share Proto | Status    | Is Public | Share Type Name | Host                 | Availability Zone |
+--------------------------------------+---------+------+-------------+-----------+-----------+-----------------+----------------------+-------------------+
| 10f5a2a1-36f5-45aa-a8e6-00e94e592e88 | Share1  | 1    | NFS         | available | False     | my_type         | manila@paris#epsilon | nova              |
| 195e3ba2-9342-446a-bc93-a584551de0ac | Share2  | 1    | NFS         | available | True      | default         | manila@london#LONDON | nova              |
+--------------------------------------+---------+------+-------------+-----------+-----------+-----------------+----------------------+-------------------+</literal_block>
            <paragraph>Check the share status and see the share export locations. After <literal>creating</literal>
                status share should have status <literal>available</literal>:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila show Share2
+----------------------+----------------------------------------------------------------------+
| Property             | Value                                                                |
+----------------------+----------------------------------------------------------------------+
| status               | available                                                            |
| share_type_name      | default                                                              |
| description          | My second share                                                      |
| availability_zone    | nova                                                                 |
| share_network_id     | c895fe26-92be-4152-9e6c-f2ad230efb13                                 |
| export_locations     |                                                                      |
|                      | path = 10.254.0.3:/shares/share-fe874928-39a2-441b-8d24-29e6f0fde965 |
|                      | preferred = False                                                    |
|                      | is_admin_only = False                                                |
|                      | id = de6d4012-6158-46f0-8b28-4167baca51a7                            |
|                      | share_instance_id = fe874928-39a2-441b-8d24-29e6f0fde965             |
|                      | path = 10.0.0.3:/shares/share-fe874928-39a2-441b-8d24-29e6f0fde965   |
|                      | preferred = False                                                    |
|                      | is_admin_only = True                                                 |
|                      | id = 602d0f5c-921b-4e45-bfdb-5eec8a89165a                            |
|                      | share_instance_id = fe874928-39a2-441b-8d24-29e6f0fde965             |
| share_server_id      | 2e9d2d02-883f-47b5-bb98-e053b8d1e683                                 |
| host                 | manila@london#LONDON                                                 |
| access_rules_status  | active                                                               |
| snapshot_id          | None                                                                 |
| is_public            | True                                                                 |
| task_state           | None                                                                 |
| snapshot_support     | True                                                                 |
| id                   | 195e3ba2-9342-446a-bc93-a584551de0ac                                 |
| size                 | 1                                                                    |
| name                 | Share2                                                               |
| share_type           | bf6ada49-990a-47c3-88bc-c0cb31d5c9bf                                 |
| has_replicas         | False                                                                |
| replication_type     | None                                                                 |
| created_at           | 2016-03-25T12:13:40.000000                                           |
| share_proto          | NFS                                                                  |
| consistency_group_id | None                                                                 |
| project_id           | 907004508ef4447397ce6741a8f037c1                                     |
| metadata             | {u'aim': u'testing'}                                                 |
+----------------------+----------------------------------------------------------------------+</literal_block>
            <paragraph><literal>is_public</literal> defines the level of visibility for the share: whether other
                projects can or cannot see the share. By default, the share is private.</paragraph>
        </section>
        <section ids="update-share" names="update\ share">
            <title>Update share</title>
            <paragraph>Update the name, or description, or level of visibility for all projects for
                the share if you need:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila update Share2 --description "My second share. Updated" --is-public False

$ manila show Share2
+----------------------+----------------------------------------------------------------------+
| Property             | Value                                                                |
+----------------------+----------------------------------------------------------------------+
| status               | available                                                            |
| share_type_name      | default                                                              |
| description          | My second share. Updated                                             |
| availability_zone    | nova                                                                 |
| share_network_id     | c895fe26-92be-4152-9e6c-f2ad230efb13                                 |
| export_locations     |                                                                      |
|                      | path = 10.254.0.3:/shares/share-fe874928-39a2-441b-8d24-29e6f0fde965 |
|                      | preferred = False                                                    |
|                      | is_admin_only = False                                                |
|                      | id = de6d4012-6158-46f0-8b28-4167baca51a7                            |
|                      | share_instance_id = fe874928-39a2-441b-8d24-29e6f0fde965             |
|                      | path = 10.0.0.3:/shares/share-fe874928-39a2-441b-8d24-29e6f0fde965   |
|                      | preferred = False                                                    |
|                      | is_admin_only = True                                                 |
|                      | id = 602d0f5c-921b-4e45-bfdb-5eec8a89165a                            |
|                      | share_instance_id = fe874928-39a2-441b-8d24-29e6f0fde965             |
| share_server_id      | 2e9d2d02-883f-47b5-bb98-e053b8d1e683                                 |
| host                 | manila@london#LONDON                                                 |
| access_rules_status  | active                                                               |
| snapshot_id          | None                                                                 |
| is_public            | False                                                                |
| task_state           | None                                                                 |
| snapshot_support     | True                                                                 |
| id                   | 195e3ba2-9342-446a-bc93-a584551de0ac                                 |
| size                 | 1                                                                    |
| name                 | Share2                                                               |
| share_type           | bf6ada49-990a-47c3-88bc-c0cb31d5c9bf                                 |
| has_replicas         | False                                                                |
| replication_type     | None                                                                 |
| created_at           | 2016-03-25T12:13:40.000000                                           |
| share_proto          | NFS                                                                  |
| consistency_group_id | None                                                                 |
| project_id           | 907004508ef4447397ce6741a8f037c1                                     |
| metadata             | {u'aim': u'testing'}                                                 |
+----------------------+----------------------------------------------------------------------+</literal_block>
            <paragraph>A share can have one of these status values:</paragraph>
            <table>
                <tgroup cols="2">
                    <colspec colwidth="35"></colspec>
                    <colspec colwidth="41"></colspec>
                    <thead>
                        <row>
                            <entry>
                                <paragraph>Status</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Description</paragraph>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph>creating</paragraph>
                            </entry>
                            <entry>
                                <paragraph>The share is being created.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>deleting</paragraph>
                            </entry>
                            <entry>
                                <paragraph>The share is being deleted.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>error</paragraph>
                            </entry>
                            <entry>
                                <paragraph>An error occurred during share creation.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>error_deleting</paragraph>
                            </entry>
                            <entry>
                                <paragraph>An error occurred during share deletion.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>available</paragraph>
                            </entry>
                            <entry>
                                <paragraph>The share is ready to use.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>manage_starting</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Share manage started.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>manage_error</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Share manage failed.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>unmanage_starting</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Share unmanage started.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>unmanage_error</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Share cannot be unmanaged.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>unmanaged</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Share was unmanaged.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>extending</paragraph>
                            </entry>
                            <entry>
                                <paragraph>The extend, or increase, share size
                                    request was issued successfully.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>extending_error</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Extend share failed.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>shrinking</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Share is being shrunk.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>shrinking_error</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Failed to update quota on share
                                    shrinking.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>shrinking_possible_data_loss_error</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Shrink share failed due to possible data
                                    loss.</paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph>migrating</paragraph>
                            </entry>
                            <entry>
                                <paragraph>Share migration is in progress.</paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
            <target refid="share-metadata"></target>
        </section>
        <section ids="share-metadata id1" names="share\ metadata share_metadata">
            <title>Share metadata</title>
            <paragraph>If you want to set the metadata key-value pairs on the share, run:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila metadata Share2 set project=my_abc deadline=01/20/16</literal_block>
            <paragraph>Get all metadata key-value pairs of the share:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila metadata-show Share2
+----------+----------+
| Property | Value    |
+----------+----------+
| aim      | testing  |
| project  | my_abc   |
| deadline | 01/20/16 |
+----------+----------+</literal_block>
            <paragraph>You can update the metadata:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila metadata-update-all Share2 deadline=01/30/16
+----------+----------+
| Property | Value    |
+----------+----------+
| deadline | 01/30/16 |
+----------+----------+</literal_block>
            <paragraph>You also can unset the metadata using
                <strong>manila metadata &lt;share_name&gt; unset &lt;metadata_key(s)&gt;</strong>.</paragraph>
        </section>
        <section ids="reset-share-state" names="reset\ share\ state">
            <title>Reset share state</title>
            <paragraph>As administrator, you can reset the state of a share.</paragraph>
            <paragraph>Use <strong>manila reset-state [â€“state &lt;state&gt;] &lt;share&gt;</strong> command to reset share
                state, where <literal>state</literal> indicates which state to assign the share. Options
                include <literal>available</literal>, <literal>error</literal>, <literal>creating</literal>, <literal>deleting</literal>,
                <literal>error_deleting</literal> states.</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila reset-state Share2 --state deleting

$ manila show Share2
+----------------------+----------------------------------------------------------------------+
| Property             | Value                                                                |
+----------------------+----------------------------------------------------------------------+
| status               | deleting                                                             |
| share_type_name      | default                                                              |
| description          | My second share. Updated                                             |
| availability_zone    | nova                                                                 |
| share_network_id     | c895fe26-92be-4152-9e6c-f2ad230efb13                                 |
| export_locations     |                                                                      |
|                      | path = 10.254.0.3:/shares/share-fe874928-39a2-441b-8d24-29e6f0fde965 |
|                      | preferred = False                                                    |
|                      | is_admin_only = False                                                |
|                      | id = de6d4012-6158-46f0-8b28-4167baca51a7                            |
|                      | share_instance_id = fe874928-39a2-441b-8d24-29e6f0fde965             |
|                      | path = 10.0.0.3:/shares/share-fe874928-39a2-441b-8d24-29e6f0fde965   |
|                      | preferred = False                                                    |
|                      | is_admin_only = True                                                 |
|                      | id = 602d0f5c-921b-4e45-bfdb-5eec8a89165a                            |
|                      | share_instance_id = fe874928-39a2-441b-8d24-29e6f0fde965             |
| share_server_id      | 2e9d2d02-883f-47b5-bb98-e053b8d1e683                                 |
| host                 | manila@london#LONDON                                                 |
| access_rules_status  | active                                                               |
| snapshot_id          | None                                                                 |
| is_public            | False                                                                |
| task_state           | None                                                                 |
| snapshot_support     | True                                                                 |
| id                   | 195e3ba2-9342-446a-bc93-a584551de0ac                                 |
| size                 | 1                                                                    |
| name                 | Share2                                                               |
| share_type           | bf6ada49-990a-47c3-88bc-c0cb31d5c9bf                                 |
| has_replicas         | False                                                                |
| replication_type     | None                                                                 |
| created_at           | 2016-03-25T12:13:40.000000                                           |
| share_proto          | NFS                                                                  |
| consistency_group_id | None                                                                 |
| project_id           | 907004508ef4447397ce6741a8f037c1                                     |
| metadata             | {u'deadline': u'01/30/16'}                                           |
+----------------------+----------------------------------------------------------------------+</literal_block>
        </section>
        <section ids="delete-and-force-delete-share" names="delete\ and\ force-delete\ share">
            <title>Delete and force-delete share</title>
            <paragraph>You also can force-delete a share.
                The shares cannot be deleted in transitional states. The transitional
                states are <literal>creating</literal>, <literal>deleting</literal>, <literal>managing</literal>, <literal>unmanaging</literal>,
                <literal>migrating</literal>, <literal>extending</literal>, and <literal>shrinking</literal> statuses for the shares.
                Force-deletion deletes an object in any state. Use the <literal>policy.json</literal> file
                to grant permissions for this action to other roles.</paragraph>
            <tip>
                <paragraph>The configuration file <literal>policy.json</literal> may be used from different places.
                    The path <literal>/etc/manila/policy.json</literal> is one of expected paths by default.</paragraph>
            </tip>
            <paragraph>Use <strong>manila delete &lt;share_name_or_ID&gt;</strong> command to delete a specified share:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila delete %share_name_or_id%</literal_block>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila delete %share_name_or_id% --consistency-group %consistency-group-id%</literal_block>
            <paragraph>If you try to delete the share in one of the transitional
                state using soft-deletion youâ€™ll get an error:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila delete Share2
Delete for share 195e3ba2-9342-446a-bc93-a584551de0ac failed: Invalid share: Share status must be one of ('available', 'error', 'inactive'). (HTTP 403) (Request-ID: req-9a77b9a0-17d2-4d97-8a7a-b7e23c27f1fe)
ERROR: Unable to delete any of the specified shares.</literal_block>
            <paragraph>A share cannot be deleted in a transitional status, that it why an error from
                <literal>python-manilaclient</literal> appeared.</paragraph>
            <paragraph>Print the list of all shares for all projects:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila list --all-tenants
+--------------------------------------+---------+------+-------------+-----------+-----------+-----------------+----------------------+-------------------+
| ID                                   | Name    | Size | Share Proto | Status    | Is Public | Share Type Name | Host                 | Availability Zone |
+--------------------------------------+---------+------+-------------+-----------+-----------+-----------------+----------------------+-------------------+
| 10f5a2a1-36f5-45aa-a8e6-00e94e592e88 | Share1  | 1    | NFS         | available | False     | my_type         | manila@paris#epsilon | nova              |
| 195e3ba2-9342-446a-bc93-a584551de0ac | Share2  | 1    | NFS         | available | False     | default         | manila@london#LONDON | nova              |
+--------------------------------------+---------+------+-------------+-----------+-----------+-----------------+----------------------+-------------------+</literal_block>
            <paragraph>Force-delete Share2 and check that it is absent in the list of shares,
                run:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila force-delete Share2

$ manila list
+--------------------------------------+---------+------+-------------+-----------+-----------+-----------------+----------------------+-------------------+
| ID                                   | Name    | Size | Share Proto | Status    | Is Public | Share Type Name | Host                 | Availability Zone |
+--------------------------------------+---------+------+-------------+-----------+-----------+-----------------+----------------------+-------------------+
| 10f5a2a1-36f5-45aa-a8e6-00e94e592e88 | Share1  | 1    | NFS         | available | False     | my_type         | manila@paris#epsilon | nova              |
+--------------------------------------+---------+------+-------------+-----------+-----------+-----------------+----------------------+-------------------+</literal_block>
            <target refid="access-to-share"></target>
        </section>
        <section ids="manage-access-to-share access-to-share" names="manage\ access\ to\ share access_to_share">
            <title>Manage access to share</title>
            <paragraph>The Shared File Systems service allows to grant or deny access to a specified
                share, and list the permissions for a specified share.</paragraph>
            <paragraph>To grant or deny access to a share, specify one of these supported share
                access levels:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>rw</strong>. Read and write (RW) access. This is the default value.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>ro</strong>. Read-only (RO) access.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>You must also specify one of these supported authentication methods:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>ip</strong>. Authenticates an instance through its IP address. A valid
                        format is <literal>XX.XX.XX.XX</literal> or <literal>XX.XX.XX.XX/XX</literal>. For example <literal>0.0.0.0/0</literal>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>user</strong>. Authenticates by a specified user or group name. A valid value is
                        an alphanumeric string that can contain some special characters and is from
                        4 to 32 characters long.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>cert</strong>. Authenticates an instance through a TLS certificate. Specify the
                        TLS identity as the IDENTKEY. A valid value is any string up to 64 characters
                        long in the common name (CN) of the certificate. The meaning of a string
                        depends on its interpretation.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>cephx</strong>. Ceph authentication system. Specify the Ceph auth ID that needs
                        to be authenticated and authorized for share access by the Ceph back end. A
                        valid value must be non-empty, consist of ASCII printable characters, and not
                        contain periods.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>Try to mount NFS share with export path
                <literal>10.0.0.4:/shares/manila_share_a5fb1ab7_0bbd_465b_ac14_05706294b6e9</literal> on the
                node with IP address <literal>10.0.0.13</literal>:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ sudo mount -v -t nfs 10.0.0.4:/shares/manila_share_a5fb1ab7_0bbd_465b_ac14_05706294b6e9 /mnt/
mount.nfs: timeout set for Tue Oct  6 10:37:23 2015
mount.nfs: trying text-based options 'vers=4,addr=10.0.0.4,clientaddr=10.0.0.13'
mount.nfs: mount(2): Permission denied
mount.nfs: access denied by server while mounting 10.0.0.4:/shares/manila_share_a5fb1ab7_0bbd_465b_ac14_05706294b6e9</literal_block>
            <paragraph>An error message â€œPermission deniedâ€ appeared, so you are not allowed to mount
                a share without an access rule. Allow access to the share with <literal>ip</literal> access
                type and <literal>10.0.0.13</literal> IP address:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila access-allow Share1 ip 10.0.0.13 --access-level rw
+--------------+--------------------------------------+
| Property     | Value                                |
+--------------+--------------------------------------+
| share_id     | 10f5a2a1-36f5-45aa-a8e6-00e94e592e88 |
| access_type  | ip                                   |
| access_to    | 10.0.0.13                            |
| access_level | rw                                   |
| state        | new                                  |
| id           | de715226-da00-4cfc-b1ab-c11f3393745e |
+--------------+--------------------------------------+</literal_block>
            <paragraph>Try to mount a share again. This time it is mounted successfully:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ sudo mount -v -t nfs 10.0.0.4:/shares/manila_share_a5fb1ab7_0bbd_465b_ac14_05706294b6e9 /mnt/</literal_block>
            <paragraph>Since it is allowed node on 10.0.0.13 read and write access, try to create
                a file on a mounted share:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ cd /mnt
$ ls
lost+found
$ touch my_file.txt</literal_block>
            <paragraph>Connect via SSH to the <literal>10.0.0.4</literal> node and check new file <title_reference>my_file.txt</title_reference>
                in the <literal>/shares/manila_share_a5fb1ab7_0bbd_465b_ac14_05706294b6e9</literal> directory:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ ssh 10.0.0.4
$ cd /shares
$ ls
manila_share_a5fb1ab7_0bbd_465b_ac14_05706294b6e9
$ cd manila_share_a5fb1ab7_0bbd_465b_ac14_05706294b6e9
$ ls
lost+found  my_file.txt</literal_block>
            <paragraph>You have successfully created a file from instance that was given access by
                its IP address.</paragraph>
            <paragraph>Allow access to the share with <literal>user</literal> access type:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila access-allow Share1 user demo --access-level rw
+--------------+--------------------------------------+
| Property     | Value                                |
+--------------+--------------------------------------+
| share_id     | 10f5a2a1-36f5-45aa-a8e6-00e94e592e88 |
| access_type  | user                                 |
| access_to    | demo                                 |
| access_level | rw                                   |
| state        | new                                  |
| id           | 4f391c6b-fb4f-47f5-8b4b-88c5ec9d568a |
+--------------+--------------------------------------+</literal_block>
            <note>
                <paragraph>Different share features are supported by different share drivers.
                    For the example, the Generic driver with the Block Storage service as a
                    back-end doesnâ€™t support <literal>user</literal> and <literal>cert</literal> authentications methods. For
                    details of supporting of features by different drivers, see <reference name="Manila share features support mapping" refuri="https://docs.openstack.org/developer/manila/devref/share_back_ends_feature_support_mapping.html">Manila share
                        features support mapping</reference><target ids="manila-share-features-support-mapping" names="manila\ share\ features\ support\ mapping" refuri="https://docs.openstack.org/developer/manila/devref/share_back_ends_feature_support_mapping.html"></target>.</paragraph>
            </note>
            <paragraph>To verify that the access rules (ACL) were configured correctly for a share,
                you list permissions for a share:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila access-list Share1
+--------------------------------------+-------------+------------+--------------+--------+
| id                                   | access type | access to  | access level | state  |
+--------------------------------------+-------------+------------+--------------+--------+
| 4f391c6b-fb4f-47f5-8b4b-88c5ec9d568a | user        | demo       | rw           | error  |
| de715226-da00-4cfc-b1ab-c11f3393745e | ip          | 10.0.0.13  | rw           | active |
+--------------------------------------+-------------+------------+--------------+--------+</literal_block>
            <paragraph>Deny access to the share and check that deleted access rule is absent in the
                access rule list:</paragraph>
            <literal_block highlight_args="{}" language="console" linenos="False" xml:space="preserve">$ manila access-deny Share1 de715226-da00-4cfc-b1ab-c11f3393745e

$ manila access-list Share1
+--------------------------------------+-------------+-----------+--------------+-------+
| id                                   | access type | access to | access level | state |
+--------------------------------------+-------------+-----------+--------------+-------+
| 4f391c6b-fb4f-47f5-8b4b-88c5ec9d568a | user        | demo      | rw           | error |
+--------------------------------------+-------------+-----------+--------------+-------+</literal_block>
        </section>
    </section>
</document>
